L.AnimatedMarker=L.Marker.extend({options:{distance:200,interval:1e3,autoStart:!0,onEnd:function(){},onStep:function(){},clickable:!1},initialize:function(n,t){L.DomUtil.TRANSITION?this._latlngs=n:(this._latlngs=this._chunk(n),this.options.distance=10,this.options.interval=30);L.Marker.prototype.initialize.call(this,n[0],t)},_chunk:function(n){for(var o=n.length,f=[],i=1;i<o;i++){var t=n[i-1],r=n[i],u=t.distanceTo(r),e=this.options.distance/u,s=e*(r.lat-t.lat),h=e*(r.lng-t.lng);if(u>this.options.distance)while(u>this.options.distance)t=new L.LatLng(t.lat+s,t.lng+h),u=t.distanceTo(r),f.push(t);else f.push(t)}return f},onAdd:function(n){L.Marker.prototype.onAdd.call(this,n);this.options.autoStart&&this.start()},resetAM:function(){this._i=0;var n=this._latlngs[0];L.DomUtil.TRANSITION&&(this._icon&&(this._icon.style[L.DomUtil.TRANSITION]=""),this._shadow&&(this._shadow.style[L.DomUtil.TRANSITION]=""));this.setLatLng(n)},isFinished:function(){return this._i===this._latlngs.length},animate:function(){var n=this,r=this._latlngs.length,t=this.options.interval,i;this._i<r&&(t=this._i>0?this._latlngs[this._i-1].distanceTo(this._latlngs[this._i])/this.options.distance*this.options.interval:this._latlngs[this._i+1].distanceTo(this._latlngs[this._i])/this.options.distance*this.options.interval);L.DomUtil.TRANSITION&&(this._icon&&(this._icon.style[L.DomUtil.TRANSITION]="all "+t+"ms linear"),this._shadow&&(this._shadow.style[L.DomUtil.TRANSITION]="all "+t+"ms linear"));i=this._latlngs[this._i];this.setLatLng(i);this._i++;n.options.onStep&&setTimeout(function(){n.options.onStep(i)},1);this._tid=setTimeout(function(){n._i===r?n.options.onEnd.apply(n,Array.prototype.slice.call(arguments)):n.animate()},t)},start:function(){this._i?this.resetAM():this._i=1;this.startagain()},startagain:function(){this._i||(this._i=1);var n=this;setTimeout(function(){n.animate()},10)},stop:function(){this._tid&&clearTimeout(this._tid)}});L.animatedMarker=function(n,t){return new L.AnimatedMarker(n,t)};